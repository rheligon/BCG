{% extends "matcher/base.html" %}
{% load humanize %}
{% load staticfiles %}
{% load formatofecha %}
{% block title %}Intraday (Detalle de Transacciones){% endblock %}

{%block head%}
<!-- No hace falta cargar dataTables.css original si se incluye el de bootstrap -->
<link rel="stylesheet" href="{% static 'css/dataTables/dataTables.bootstrap.css' %}">
<link rel="stylesheet" href="{% static 'css/jquery-form-validation/jquery.validation.css' %}">
<link rel="stylesheet" href="{% static 'css/sweet-alert.css' %}">
<link rel="stylesheet" href="{% static 'css/procesando.css' %}">
<link rel="stylesheet" href="{% static 'css/picker.css' %}">
<link rel="stylesheet" href="{% static 'css/picker.date.css' %}">
{%endblock%}

{% block content %}
<style> form {padding-bottom: 1%;} #table-div-conta, #table-div-corr {padding-top: 1%;}</style>

<legend><h1>Intraday (Detalle de Transacciones)</h1></legend>

    <div class="row clearfix" >
      <!-- Select Basic -->
      <div class="form-group col-md-6 ">
        <h4>Cuenta: <strong>{{cuenta.codigo}}</strong></h4><h4> Transacciones Desde: <strong>{{fecha}}</strong> Hasta: <strong>{{fechaActual}}</strong></h4>
      </div> 
      <div class="form-group col-md-6 ">
        {% if errores%}
        <div class="alert alert-danger alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <strong>Existen Archivos con errores en su Directorio de Mensajes Erróneos, <br>Por Favor verifique.</strong>
        </div>
        {% endif %}
      </div> 
    </div>
  

<form class="form-inline">
  <fieldset>
<div ="row" id="tablaArchive">
  <div style="padding-bottom:1%;" class="col-md-3 pull-right">
  </div>
</div>
  <div class="tab-pane active" id="conta-tab">
    <div id="table-div-conta" class="table-responsive col-md-12" >
      <table id="table-pa" class="table table-bordered table-striped tabla">
        <thead>
          <tr>
            <th>I/O</th>
            <th>MT</th>
            <th>Débitos</th>
            <th>Créditos</th>
            <th>Fecha Entrada / Hora</th>
            <th>Fecha Valor</th>
            <th>Observaciones</th>
            
            
          </tr>
        </thead>
        <tbody id="tb-conta" style="height:400px;overflow-y: auto;overflow-x: hidden;">
          {% for mensaje in mensajes %}
          <!--{{mensaje.mensaje_intraday.tipo}}-->
            {% if mensaje.mensaje_intraday.tipo == "103" %}

              <tr>
                <td>{{mensaje.mensaje_intraday.i_o}}</td>
                <td ><a id="mostrar_info" value = "{{mensaje.mensaje_intraday.idmensaje}}" name="{{mensaje.mensaje_intraday.idmensaje}}" tipo="{{mensaje.mensaje_intraday.tipo}}" refremitente="{{mensaje.ref_remitente}}" indHora="{{mensaje.ind_hora}}" tipoOpBanco="{{mensaje.tipo_op_banco}}" codInst="{{mensaje.cod_instruccion}}" tipoTrans="{{mensaje.tipo_transaccion}}" monedaMonto="{{mensaje.moneda_monto}}" tipoCambio="{{mensaje.tipo_cambio}}" clienteOrd="{{mensaje.cliente_ordenante}}" instEmi="{{mensaje.institucion_emisor}}" instOrd="{{mensaje.institucion_ordenante}}" corrRemit="{{mensaje.corresponsal_remitente}}" corrRecept="{{mensaje.corresponsal_receptor}}" instReemb="{{mensaje.institucion_reembolso}}" instInter="{{mensaje.institucion_intermediaria}}" ctaInst="{{mensaje.cuenta_institucion}}" clienteBene="{{mensaje.cliente_beneficiario}}" infoRemesa="{{mensaje.info_remesa}}" detCargos="{{mensaje.detalle_cargos}}" cargRemit="{{mensaje.cargos_remitente}}" cargRecept="{{mensaje.cargos_receptor}}" infoRemitARecept="{{mensaje.info_remitente_a_receptor}}" repReg="{{mensaje.reporte_regulatorio}}" remitente="{{mensaje.remitente}}" receptor="{{mensaje.receptor}}" fechaVal="{{mensaje.fecha_valor}}" moneda="{{mensaje.moneda}}" monto="{{mensaje.monto}}" data-toggle="modal" href="#myModal">{{mensaje.mensaje_intraday.tipo}}</a></td>
                {% if mensaje.mensaje_intraday.i_o == "O" %}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  <td></td>
                  {% endif %}
                {% elif mensaje.mensaje_intraday.i_o == "I"%}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td></td>
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  {% endif %}
                {% endif %}
                <td>{{mensaje.mensaje_intraday.fecha_entrada|formato24hrs}}</td>
                <td>{{mensaje.fecha_valor}}</td>
                <td>{{mensaje.mensaje_intraday.observacion}}</td>
              </tr>
            {% elif mensaje.mensaje_intraday.tipo == "202"%}
              <tr>
                <td>{{mensaje.mensaje_intraday.i_o}}</td>
                <td><a id="mostrar_info" value = "{{mensaje.mensaje_intraday.idmensaje}}" name="{{mensaje.mensaje_intraday.idmensaje}}" tipo="{{mensaje.mensaje_intraday.tipo}}" refTrans="{{mensaje.ref_transaccion}}" refRel="{{mensaje.ref_relacion}}" indHora="{{mensaje.ind_hora}}" instOrd="{{mensaje.institucion_ordenante}}" corrRemit="{{mensaje.corresponsal_remitente}}" corrRecept="{{mensaje.corresponsal_receptor}}" inter="{{mensaje.intermediario}}" ctaInst="{{mensaje.cuenta_institucion}}" instBene="{{mensaje.institucion_beneficiaria}}" infoRemitARecept="{{mensaje.info_remitente_a_receptor}}" remitente="{{mensaje.remitente}}" receptor="{{mensaje.receptor}}" fechaVal="{{mensaje.fecha_valor}}" moneda="{{mensaje.moneda}}" monto="{{mensaje.monto}}" data-toggle="modal" href="#myModal">{{mensaje.mensaje_intraday.tipo}}</a></td>
                {% if mensaje.mensaje_intraday.i_o == "O" %}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  <td></td>
                  {% endif %}
                {% elif mensaje.mensaje_intraday.i_o == "I"%}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td></td>
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  {% endif %}
                {% endif %}
                <td>{{mensaje.mensaje_intraday.fecha_entrada|formato24hrs}}</td>
                <td>{{mensaje.fecha_valor}}</td>
                <td>{{mensaje.mensaje_intraday.observacion}}</td>
              </tr>
            {% elif mensaje.mensaje_intraday.tipo == "756"%}
              <tr>
                <td>{{mensaje.mensaje_intraday.i_o}}</td>
                <td><a id="mostrar_info" value = "{{mensaje.mensaje_intraday.idmensaje}}" name="{{mensaje.mensaje_intraday.idmensaje}}" tipo="{{mensaje.mensaje_intraday.tipo}}" refRemit="{{mensaje.ref_remitente}}" refBanPre="{{mensaje.ref_banco_present}}" monedaMonto="{{mensaje.moneda_monto}}" corrRemit="{{mensaje.corresponsal_remitente}}" corrRecept="{{mensaje.corresponsal_receptor}}" infoRemitARecept="{{mensaje.info_remitente_a_receptor}}" remitente="{{mensaje.remitente}}" receptor="{{mensaje.receptor}}" fechaVal="{{mensaje.fecha_valor}}" moneda="{{mensaje.moneda}}" monto="{{mensaje.monto}}" data-toggle="modal" href="#myModal">{{mensaje.mensaje_intraday.tipo}}</a></td>
                {% if mensaje.mensaje_intraday.i_o == "O" %}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  <td></td>
                  {% endif %}
                {% elif mensaje.mensaje_intraday.i_o == "I"%}
                  {% if mensaje.mensaje_intraday.observacion != "" %}
                  <td></td>
                  <td></td>
                  {% else %}
                  <td></td>
                  <td>{{mensaje.monto|intcomma|cut:"-"}}</td>
                  {% endif %}
                {% endif %}
                <td>{{mensaje.mensaje_intraday.fecha_entrada|formato24hrs}}</td>
                <td>{{mensaje.fecha_valor}}</td>
                <td>{{mensaje.mensaje_intraday.observacion}}</td>
              </tr>
            {% endif %}
          {% endfor %}    
            
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-md-7" align="rigth">
            <button type="button" id="boton-regresar" value ="{{cuenta.idcuenta}}" style="align:right" class="col-md-3 btn btn-warning"><a href="/intraday/{{cuenta.idcuenta}}">
                 {%if idioma == 0%}
                    Regresar
                {%endif%}
                {%if idioma == 1%}
                    Back
                {%endif%}
            </a></button>
        </div>
  </fieldset>
</form>

<!-- Static Modal para procesando -->
<div class="modal modal-static fade" id="processing-modal" role="dialog" aria-hidden="true">
    <div class="modal-dialog" >
        <div class="modal-content" >
            <div class="modal-body">
                <div class="text-center">
                    <img src="{% static 'images/procesando.gif' %}" class="icon" />
                    <h4>Procesando, por favor espere.</h4>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="width:700px">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel"></h4>
      </div>
      <div id="cuerpo" class="modal-body">
        <div class="tab-pane active">
          <div id="table-div-conta" class="table-responsive">
            <table id="table-info" class="table table-bordered table-striped tabla">
              <thead>
                <tr>
                  {%if idioma == 0%}
                    <th>Etiqueta</th>
                    <th>Nombre del Campo</th>
                    <th>Contenido</th>
                  {%endif%}
                  {%if idioma == 1%}
                    <th>Tag</th>
                    <th>Field Name</th>
                    <th>Content</th>
                  {%endif%}
                </tr>
              </thead>
              <tbody id="info-mensaje">
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block script%}
<script> 
    //define el idioma de la tabla (es/en)
    idioma_tr = "es"
</script>

<script src="{% static 'js/jquery.dataTables.min.js' %}" type="text/javascript"></script>
<script src="{% static 'js/dataTables.bootstrap.js' %}" type="text/javascript"></script>
<script src="{% static 'js/jquery-form-validation/jquery.validation.min.js' %}"></script>
<script src="{% static 'js/sweet-alert.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/picker.js' %}"></script>
<script type="text/javascript" src="{% static 'js/picker.date.js' %}"></script>
<script type="text/javascript" src="{% static 'js/pickerlegacy.js' %}"></script>
<script src="{% static 'js/transIntraday.js' %}" type="text/javascript"></script>
<script type="text/javascript">
var idioma = $('#idioma').val();
var idiomaAux = "";

if (idioma == 0){
    idiomaAux = "es"
} else {
    idiomaAux = "en"
}
iniciar_tabla(idiomaAux);

function iniciar_tabla(idioma){

    
    if (idioma==="es"){

        return $('#table-pa').DataTable({
            //poner if con idioma, el ingles es predeterminado
            
            language: {
                url: '/static/json/Spanish-tables.json'
            },
            "ordering":false,
             "columns": [
                { "width": "5%" },//Edo. Cuenta
                { "width": "5%" },//Num. Trans
                { "width": "12%" },//Fecha Valor
                { "width": "12%" },//Edo. Cuenta
                { "width": "16%" },//Num. Trans
                { "width": "10%" },//Fecha Valor
                { "width": "30%" },//Edo. Cuenta
              ]
        })

    }else if (idioma==="en"){

        return $('#table-pa').DataTable({
          
            language: {
                url: '/static/json/English-tables.json'
            },
             "ordering":false,
             "columns": [
                { "width": "5%" },//Edo. Cuenta
                { "width": "5%" },//Num. Trans
                { "width": "12%" },//Fecha Valor
                { "width": "12%" },//Edo. Cuenta
                { "width": "16%" },//Num. Trans
                { "width": "10%" },//Fecha Valor
                { "width": "30%" },//Edo. Cuenta
              ]
        })
    };
};
</script>
{% endblock %}
